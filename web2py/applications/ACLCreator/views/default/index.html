{{extend 'layout.html'}}

<div class="col-md-6">
    <form action="#" enctype="multipart/form-data" method="post">

        <div class="col-md-5">
            CSV File <input type='file' name="csv_file"/>
            <table class="table table-responsive table-hover">
                <thead>
                <tr>
                    <td>Files in DB</td>
                </tr>
                </thead>
                <tbody>
                {{for row in current_files:}}
                <tr>
                    <td><a href="{{=URL('default', 'table', vars={'filename':row.f_name})}}">{{=row.f_name}}</a></td>
                </tr>
                {{pass}}
                </tbody>
            </table>
        </div>
        <label id="ports">Max Port</label><input value="15000" id='ports' type="text" name="ports">
        <div class="col-md-5">
            <input type="submit"/>
            <input type="hidden" name="_formname" value="test" class="btn btn-round btn-primary"/>
            <br>
            <button class="btn btn-round btn-primary" id="create_table"
                    onclick="window.location = '{{=URL('default', 'table', vars={'filename': f_id, 'ports': ports})}}'">
                Create conn table
            </button>

        </div>

    </form>
</div>
<div class="col-md-6">
    <table class="table hover">
        <thead>
        <tr>
            <td style="font-weight: 700">
                Settings
            </td>
            <td style="font-weight: 700">
                Value
            </td>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>
                "Source IP column"
            </td>
            <td>
                <input id="Source IP column" type="text"
                       placeholder="{{=default_set_value[session.set_name.index('Source IP column')]}}" class="settings"
                       value="{{=set_value[session.set_name.index('Source IP column')]}}">
            </td>
        </tr>
        <tr>
            <td>
                "Destination IP column"
            </td>
            <td>
                <input id="Destination IP column" type="text"
                       placeholder="{{=default_set_value[session.set_name.index('Destination IP column')]}}"
                       class="settings"
                       value="{{=set_value[session.set_name.index('Destination IP column')]}}">
            </td>
        </tr>
        <tr>
            <td>
                "Destination PORT column"
            </td>
            <td>
                <input id="Destination PORT column" type="text"
                       placeholder="{{=default_set_value[session.set_name.index('Destination PORT column')]}}"
                       class="settings"
                       value="{{=set_value[session.set_name.index('Destination PORT column')]}}">
            </td>
        </tr>
        <tr>
            <td>
                "PROTOCOL column"
            </td>
            <td>
                <input id="PROTOCOL column" type="text"
                       placeholder="{{=default_set_value[session.set_name.index('PROTOCOL column')]}}" class="settings"
                       value="{{=set_value[session.set_name.index('PROTOCOL column')]}}">
            </td>
        <tr>
            <td>
                <button class="btn btn-round btn-primary" id="set_settings">Set settings</button>
            </td>
        </tr>
        </tbody>
    </table>

</div>

        <script>
            $("#set_settings").click(function(){
                let objects = document.getElementsByClassName('settings');
                set_value = [];
                set_name = [];
                for (i = 0; i < objects.length; i++) {
                    set_name.push(objects[i].id);
                    if (objects[i].value === '') {
                        set_value.push(objects[i].placeholder);
                    }
                    else {
                        set_value.push(objects[i].value)
                    }

                }

                $.ajax({
                    type: "POST",
                    data: {set_value:set_value,
                    set_name:set_name},
                    url: "{{=URL('default', 'set_session_settings')}}"
                });
            });

           function getInputFields(obj) {
               event.preventDefault();
               window.history.pushState(null,"", obj.getAttribute("href"));
           let e = document.getElementsByClassName('input-data');
           for (i = 0; i < e.length ; i++ ) {
               addQSParam(e[i].name, e[i].value, obj.getAttribute("href"))
           }
           window.location.href = window.location.href
           }

           function addQSParam(name, value) {
    var url=window.location.href,
    separator = (url.indexOf("?")=== -1)?"?":"&";
        if (!(url.indexOf(name) === -1)) {
           newParam=separator + value;
           newUrl=url.replace(newParam,"");
           newUrl+=newParam;
        }
        else {
        newParam=separator + name + '=' + value;
    newUrl=url.replace(newParam,"");
    newUrl+=newParam;
        }
    window.history.pushState(null,"", newUrl);
    }

        </script>


